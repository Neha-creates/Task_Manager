<!--Carbon Intensity Tracker-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIT</title>
    <style>
        body{
            margin: 20px;
            text-align: center;
        }
        table{
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            align-items: center;
        }
        th, td{
            border: 1px solid;
            text-align: center;
        }
    </style>
</head>
<body>
    <h2>Carbon Intensity Data</h2>
    <label for="date">Select Date:</label>
    <input type="date" id="date">
    <button onclick="showData()">Fetch Data</button>
    
    <table id="data-table" style="display:none;">
        <thead>
            <tr>
                <th>Time Period</th>
                <th>Intensity (gCO2/kWh)</th>
                <th>Forecast</th>
                <th>Actual</th>
                <th>Category</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</body>
</html>
<script>
    function formatTime(isoString){
        const date = new Date(isoString);
        return date.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit' });
    }

    async function showData(){
        const date = document.getElementById('date').value;
        if(!date){
            alert('Please select a date');
            return;
        }
        try {
            const res = await fetch('https://api.carbonintensity.org.uk/intensity/date');
            const data = await res.json();
            const table = document.getElementById('data-table');
            const tbody = table.querySelector('tbody');
            tbody.innerHTML = '';

            let dataT = data.data;
            console.log(dataT)
            dataT.forEach((row)=>{
                const tr = document.createElement('tr');
                tr.innerHTML = `
                <td>${formatTime(row.from)} - ${formatTime(row.to)}</td>
                <td>${row.intensity.actual ?? 'N/A'}</td>
                <td>${row.intensity.forecast}</td>
                <td>${row.intensity.actual ?? 'N/A'}</td>
                <td>${row.intensity.index}</td>
                `;
                tbody.appendChild(tr);
            });
            table.style.display = 'table';
            //console.log(inTensity)
        } catch (error) {
            alert('Error fetching data. Please try again later.');
            console.log(error);
        }
    }
</script>